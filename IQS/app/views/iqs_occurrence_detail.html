<div class="app-shell">
    <div class="topbar">
        <div class="brand">
            <div class="brand-logo"></div>
            <div>
                <div class="brand-text-main">IQS - Safety Management Studio</div>
                <div class="brand-text-sub">Version Beta 0.5</div>
            </div>
        </div>
        <div class="topbar-right">
            <div class="pill">
                <span class="pill-dot"></span>
                <span>Demo data – not connected to live SMS</span>
            </div>
        </div>
    </div>

    <div class="main-layout">
        <div class="sidebar">
            <div class="nav-section-title">Safety core</div>
            <div class="nav-item" ng-class="{active: shell.isRoute('/hazards')}" ng-click="shell.go('/hazards')">
                <span class="nav-icon">⚠️</span>
                <span class="nav-label-main">Hazards</span>
                <span class="nav-badge">Register</span>
            </div>
            <div class="nav-item" ng-class="{active: shell.isRoute('/occurrences')}" ng-click="shell.go('/occurrences')">
                <span class="nav-icon">📋</span>
                <span class="nav-label-main">Occurrences</span>
                <span class="nav-badge">Reports</span>
            </div>

            <div class="nav-section-title">Change & assurance</div>
            <div class="nav-item" ng-class="{active: shell.isRoute('/mocs')}" ng-click="shell.go('/mocs')">
                <span class="nav-icon">♻️</span>
                <span class="nav-label-main">MOCs</span>
                <span class="nav-badge">Change</span>
            </div>
            <div class="nav-item" ng-class="{active: shell.isRoute('/audit')}" ng-click="shell.go('/audit')">
                <span class="nav-icon">📝</span>
                <span class="nav-label-main">Audits</span>
                <span class="nav-badge">Assurance</span>
            </div>

            <div class="nav-footer">
                <div><strong>Demo focus:</strong> hazard log, risk matrix, MOC & audit linkages and hazard-level actions/monitoring.</div>
            </div>
        </div>

        <div class="content-area">



            <div>
                <div class="page-header">
                    <div class="page-title-block">
                        <div class="page-title">
                            Occurrence – {{ item.ref || 'Demo ref' }}
                            <span class="page-title-pill">Ground incident / damage</span>
                        </div>
                        <div class="page-subtitle">
                            Simplified ground incident / accident / damage report, aligned with your existing safety forms.
                        </div>
                    </div>
                    <div class="page-actions">
                        <button class="btn btn-ghost" ng-click="back()">
                            <span class="icon">←</span>
                            Back to occurrences
                        </button>
                    </div>
                </div>

                <div class="flex-two-col">
                    <!-- LEFT: main report form -->
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Ground incident report</div>
                                <div class="card-subtitle">
                                    Event details, damage, casualties, conditions and narrative.
                                </div>
                            </div>
                        </div>

                        <!-- Basic event info -->
                        <div class="form-grid">
                            <div class="form-group">
                                <label><span class="field-name">Date</span></label>
                                <input type="date" ng-model="item.date" />
                            </div>
                            <div class="form-group">
                                <label><span class="field-name">Local time</span></label>
                                <input type="text" ng-model="item.localTime" placeholder="e.g. 17:59" />
                            </div>

                            <div class="form-group">
                                <label><span class="field-name">Airport / location</span></label>
                                <input type="text" ng-model="item.airport" placeholder="e.g. OIMM – ramp / stand 5" />
                            </div>
                            <div class="form-group">
                                <label><span class="field-name">Area</span></label>
                                <input type="text" ng-model="item.area" placeholder="Ramp / taxiway / gate / hangar…" />
                            </div>

                            <div class="form-group">
                                <label><span class="field-name">Flight number</span></label>
                                <input type="text" ng-model="item.flightNo" placeholder="If applicable" />
                            </div>
                            <div class="form-group">
                                <label><span class="field-name">Aircraft reg</span></label>
                                <input type="text" ng-model="item.aircraftReg" placeholder="e.g. EP-ABC" />
                            </div>

                            <div class="form-group">
                                <label><span class="field-name">Phase of operation</span></label>
                                <select ng-model="item.phaseOfOperation">
                                    <option>Taxi</option>
                                    <option>Pushback</option>
                                    <option>Towing</option>
                                    <option>Boarding / deboarding</option>
                                    <option>Loading / unloading</option>
                                    <option>Parked</option>
                                    <option>Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><span class="field-name">Flight cancelled?</span></label>
                                <select ng-model="item.flightCancelled">
                                    <option>Unknown</option>
                                    <option>No</option>
                                    <option>Yes</option>
                                </select>
                            </div>

                            <div class="form-group full">
                                <label><span class="field-name">Damage details</span></label>
                                <textarea ng-model="item.damageDetails" placeholder="Summarise the damage: which aircraft / vehicle / equipment, extent of damage, any immediate impact on operations."></textarea>
                            </div>

                            <!-- Casualties -->
                            <div class="form-group full">
                                <label><span class="field-name">Number of casualties</span></label>
                                <div class="pill-kpi">
                                    <div class="kpi-row">
                                        <span class="kpi-dot"></span>
                                        <span>Employees – fatal / non-fatal</span>
                                    </div>
                                    <div class="kpi-row">
                                        <span class="kpi-dot"></span>
                                        <span>Passengers – fatal / non-fatal</span>
                                    </div>
                                    <div class="kpi-row">
                                        <span class="kpi-dot"></span>
                                        <span>Other persons – fatal / non-fatal</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Vehicle / equipment -->
                            <div class="form-group full">
                                <label><span class="field-name">Vehicle / ramp equipment details</span></label>
                                <textarea ng-model="item.vehicleDetails" placeholder="Fleet / serial number, type, owner, age, last overhaul, remarks on condition, tyres / brakes / lights / protection / warning devices…"></textarea>
                            </div>

                            <!-- Personnel involved -->
                            <div class="form-group full">
                                <label><span class="field-name">Personnel involved</span></label>
                                <textarea ng-model="item.personnelDetails" placeholder="For each person: name, company, job title, licence no, staff no."></textarea>
                            </div>

                            <!-- Conditions -->
                            <div class="form-group full">
                                <label><span class="field-name">Conditions</span></label>
                                <textarea ng-model="item.conditions" placeholder="Visibility, wind, temperature, weather (rain/snow/fog), surface (dry/wet/ice), lighting (day/night/twilight)…"></textarea>
                            </div>

                            <!-- Contributory factors -->
                            <div class="form-group full">
                                <label><span class="field-name">Contributory factors</span></label>
                                <textarea ng-model="item.contributoryFactors" placeholder="Identify factors which in your opinion contributed to the incident / accident by major factor (human / technical / organisational / environmental…)."></textarea>
                            </div>

                            <!-- Narrative + actions -->
                            <div class="form-group full">
                                <label><span class="field-name">Event narrative</span></label>
                                <textarea ng-model="item.narrative" placeholder="Give a description of what happened. Include details relevant to the contributory factors identified."></textarea>
                            </div>

                            <div class="form-group full">
                                <label><span class="field-name">Corrective action taken</span></label>
                                <textarea ng-model="item.correctiveAction" placeholder="Immediate actions taken to stabilise the situation, make the area safe and restore operations."></textarea>
                            </div>

                            <div class="form-group full">
                                <label><span class="field-name">Preventive actions / further information</span></label>
                                <textarea ng-model="item.preventiveActions" placeholder="Suggestions for preventive actions, longer-term mitigations, follow-up items."></textarea>
                            </div>

                            <div class="form-group full">
                                <label><span class="field-name">Result / closure summary</span></label>
                                <textarea ng-model="item.resultSummary" placeholder="Final outcome of the report once closed (e.g. repaired, written off, no further action, training / procedure update launched…)."></textarea>
                            </div>

                            <div class="form-group full">
                                <label><span class="field-name">Attached documents</span></label>
                                <textarea ng-model="item.attachmentsNote" placeholder="In a real system this would be a file list (photos, maintenance reports, ATC tapes, CCTV, etc.). Here it's a placeholder."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- RIGHT: referral, hazard link, evidence, comments -->
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-title">Workflow & links</div>
                                <div class="card-subtitle">
                                    Referral tree, hazard linkage, evidence and comments – simplified, based on your current forms.
                                </div>
                            </div>
                        </div>

                        <div class="tabs">
                            <div class="tab" ng-class="{active: sideTab === 'referral'}"
                                 ng-click="setSideTab('referral')">
                                <span class="tab-icon-dot"></span>Referral tree
                            </div>
                            <div class="tab" ng-class="{active: sideTab === 'hazard'}"
                                 ng-click="setSideTab('hazard')">
                                <span class="tab-icon-dot risk-low"></span>Hazard log
                            </div>
                            <div class="tab" ng-class="{active: sideTab === 'evidence'}"
                                 ng-click="setSideTab('evidence')">
                                <span class="tab-icon-dot"></span>Evidence
                            </div>
                            <div class="tab" ng-class="{active: sideTab === 'comments'}"
                                 ng-click="setSideTab('comments')">
                                <span class="tab-icon-dot"></span>Comments
                            </div>
                        </div>

                        <div ng-switch="sideTab">
                            <div ng-switch-when="referral">
                                <div class="card-subtitle" style="margin-bottom:6px;">
                                    Demo referral tree – who has seen and handled this report.
                                </div>
                                <div class="table-wrapper">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Name</th>
                                                <th>Role</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>GANJINEH – ZAHRA</td>
                                                <td>Safety manager</td>
                                                <td>Reviewing</td>
                                            </tr>
                                            <tr>
                                                <td>AGHAEIAN – VAHID</td>
                                                <td>Ground ops representative</td>
                                                <td>Action owner</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <div ng-switch-when="hazard">
                                <div class="card-subtitle" style="margin-bottom:6px;">
                                    Hazard(s) linked to this occurrence – pulled from the hazard log.
                                </div>
                                <div class="pill-kpi">
                                    <div class="kpi-row">
                                        <span class="kpi-dot risk-high"></span>
                                        <span>{{ item.hazardSummary || 'H-00023 Bird strike risk on approach to OIII (demo)' }}</span>
                                    </div>
                                    <div class="kpi-row">
                                        <span class="kpi-dot"></span>
                                        <span>This is where you’d navigate to the full hazard record.</span>
                                    </div>
                                </div>
                            </div>

                            <div ng-switch-when="evidence">
                                <div class="card-subtitle" style="margin-bottom:6px;">
                                    Key evidence and attachments (concept only in demo).
                                </div>
                                <ul class="pill-list">
                                    <li class="pill">
                                        <span class="pill-dot"></span>
                                        Ramp CCTV snapshot – pushback start
                                    </li>
                                    <li class="pill">
                                        <span class="pill-dot"></span>
                                        Engineer damage assessment report (PDF)
                                    </li>
                                    <li class="pill">
                                        <span class="pill-dot"></span>
                                        Photos from ramp crew (JPG)
                                    </li>
                                </ul>
                            </div>

                            <div ng-switch-when="comments">
                                <div class="form-group full">
                                    <label><span class="field-name">Internal comments</span></label>
                                    <textarea ng-model="item.internalComments" placeholder="Safety manager and stakeholders can leave comments, questions, decisions here."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <span><strong>Note:</strong> All content is fictitious and for concept/demo only.</span>
        <span class="link-muted" ng-click="shell.go('/hazards')">Back to hazard register</span>
    </div>
</div>



