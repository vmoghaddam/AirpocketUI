<style>
    :root {
        --bg-main: #0f172a;
        --bg-card: #111827;
        --bg-card-alt: #020617;
        --border-subtle: #1f2937;
        --accent: #3b82f6;
        --accent-soft: rgba(59, 130, 246, 0.15);
        --accent-strong: rgba(59, 130, 246, 0.5);
        --accent-danger: #ef4444;
        --accent-danger-soft: rgba(239, 68, 68, 0.15);
        --accent-warn: #f97316;
        --accent-warn-soft: rgba(249, 115, 22, 0.18);
        --accent-success: #22c55e;
        --accent-success-soft: rgba(34, 197, 94, 0.12);
        --text-main: #e5e7eb;
        --text-muted: #9ca3af;
        --text-soft: #6b7280;
        --pill-bg: #1f2937;
        --pill-border: #374151;
        --radius-lg: 18px;
        --radius-xl: 24px;
        --radius-pill: 999px;
        --input-bg: #020617;
    }

    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        background: radial-gradient(circle at top left, #1d2438 0, #020617 48%, #000 100%);
        color: var(--text-main);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
        display: flex;
        flex-direction: column;
    }

    .app-shell {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }

    .topbar {
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 28px;
        border-bottom: 1px solid rgba(55, 65, 81, 0.7);
        background: linear-gradient(to right, rgba(15,23,42,0.95), rgba(15,23,42,0.92), rgba(15,23,42,0.95));
        backdrop-filter: blur(16px);
        position: sticky;
        top: 0;
        z-index: 20;
    }

    .brand {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .brand-logo {
        width: 32px;
        height: 32px;
        border-radius: 12px;
        background: radial-gradient(circle at 30% 20%, #60a5fa, #1d4ed8 45%, #020617 100%);
        position: relative;
        overflow: hidden;
    }

        .brand-logo::after {
            content: '';
            position: absolute;
            inset: 6px;
            border-radius: 10px;
            border: 2px solid rgba(15,23,42,0.7);
        }

    .brand-text-main {
        font-weight: 600;
        letter-spacing: 0.05em;
        font-size: 0.95rem;
    }

    .brand-text-sub {
        font-size: 0.75rem;
        color: var(--text-soft);
    }

    .topbar-right {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .pill {
        padding: 4px 10px;
        border-radius: var(--radius-pill);
        border: 1px solid rgba(75,85,99,0.9);
        background: rgba(15,23,42,0.9);
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 0.75rem;
        color: var(--text-muted);
    }

    .pill-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: var(--accent-success);
    }

    .main-layout {
        flex: 1;
        display: flex;
        min-height: 0;
    }

    .sidebar {
        width: 215px;
        padding: 16px 12px 18px;
        margin-left: 0 !important;
        border-right: 1px solid rgba(55, 65, 81, 0.7);
        background: radial-gradient(circle at top left, rgba(15,23,42,0.98), rgba(15,23,42,0.96));
    }

    .nav-section-title {
        font-size: 0.7rem;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        color: var(--text-soft);
        margin: 10px 10px 6px;
    }

    .nav-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        border-radius: 12px;
        margin: 2px 4px;
        font-size: 0.86rem;
        color: var(--text-muted);
        cursor: pointer;
        transition: all 0.16s ease-out;
    }

        .nav-item span.nav-icon {
            width: 20px;
            text-align: center;
            font-size: 0.9rem;
        }

        .nav-item span.nav-label-main {
            flex: 1;
        }

        .nav-item span.nav-badge {
            border-radius: 999px;
            padding: 1px 6px 2px;
            border: 1px solid rgba(75,85,99,0.8);
            font-size: 0.68rem;
            color: var(--text-soft);
            background: rgba(15,23,42,0.9);
        }

        .nav-item:hover {
            background: rgba(30,64,175,0.14);
            color: #e5e7eb;
        }

        .nav-item.active {
            background: linear-gradient(90deg, rgba(59,130,246,0.28), rgba(59,130,246,0.06));
            color: #e5e7eb;
            border: 1px solid rgba(59,130,246,0.7);
        }

    .nav-footer {
        margin-top: 22px;
        padding: 10px 10px 0;
        border-top: 1px solid rgba(55,65,81,0.7);
        font-size: 0.75rem;
        color: var(--text-soft);
    }

        .nav-footer strong {
            color: var(--text-main);
            font-weight: 500;
        }

    .content-area {
        flex: 1;
        padding: 16px 18px 18px;
        overflow: auto;
    }

    .page-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
    }

    .page-title-block {
        display: flex;
        flex-direction: column;
        gap: 3px;
    }

    .page-title {
        font-size: 1.15rem;
        font-weight: 600;
        letter-spacing: 0.03em;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .page-title-pill {
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        padding: 2px 8px;
        border-radius: 999px;
        border: 1px solid rgba(75,85,99,0.9);
        color: var(--text-soft);
    }

    .page-subtitle {
        font-size: 0.8rem;
        color: var(--text-muted);
    }

    .page-actions {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .btn {
        border-radius: 999px;
        border: 1px solid rgba(75,85,99,0.9);
        background: rgba(15,23,42,0.9);
        color: var(--text-main);
        padding: 6px 12px;
        font-size: 0.8rem;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        transition: all 0.16s ease-out;
    }

        .btn span.icon {
            font-size: 0.9rem;
        }

    .btn-primary {
        border-color: rgba(59,130,246,0.9);
        background: radial-gradient(circle at 0 0, rgba(96,165,250,0.5), rgba(37,99,235,0.9));
        color: #eff6ff;
    }

        .btn-primary:hover {
            background: radial-gradient(circle at 0 0, rgba(129,140,248,0.7), rgba(37,99,235,1));
        }

    .btn-ghost {
        border-style: dashed;
        border-color: rgba(75,85,99,0.9);
        color: var(--text-soft);
        background: rgba(15,23,42,0.8);
    }

        .btn-ghost:hover {
            border-color: rgba(148,163,184,0.9);
            color: #e5e7eb;
        }

    .card-grid {
        display: grid;
        grid-template-columns: minmax(0, 2.2fr) minmax(0, 1.3fr);
        gap: 14px;
    }

    .card {
        background: radial-gradient(circle at top, rgba(15,23,42,0.98), rgba(2,6,23,0.98));
        border-radius: var(--radius-xl);
        border: 1px solid rgba(31,41,55,0.9);
        padding: 12px 14px;
        position: relative;
        overflow: hidden;
    }

    .card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 8px;
    }

    .card-title {
        font-size: 0.86rem;
        font-weight: 500;
    }

    .card-subtitle {
        font-size: 0.76rem;
        color: var(--text-muted);
    }

    .card-header-right {
        font-size: 0.72rem;
        color: var(--text-soft);
    }

    .table-wrapper {
        border-radius: 14px;
        border: 1px solid rgba(31,41,55,0.95);
        overflow: hidden;
        background: radial-gradient(circle at top, rgba(15,23,42,0.92), rgba(15,23,42,0.97));
    }

    table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8rem;
    }

    thead {
        background: linear-gradient(to bottom, rgba(15,23,42,0.98), rgba(15,23,42,0.9));
    }

    th, td {
        padding: 6px 9px;
        border-bottom: 1px solid rgba(31,41,55,0.9);
        text-align: left;
    }

    th {
        font-weight: 500;
        color: var(--text-soft);
        font-size: 0.75rem;
    }

    tbody tr:last-child td {
        border-bottom: none;
    }

    tbody tr:nth-child(even) {
        background: rgba(15,23,42,0.85);
    }

    tbody tr:nth-child(odd) {
        background: rgba(15,23,42,0.95);
    }

    tbody tr:hover {
        background: rgba(30,64,175,0.24);
        cursor: pointer;
    }

    .tag {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        border-radius: 999px;
        padding: 1px 7px 2px;
        font-size: 0.7rem;
        border: 1px solid rgba(55,65,81,0.9);
        background: rgba(2,6,23,0.9);
        color: var(--text-soft);
    }

    .tag-pill {
        width: 6px;
        height: 6px;
        border-radius: 999px;
    }

    .tag-pill-green {
        background: var(--accent-success);
    }

    .tag-pill-amber {
        background: var(--accent-warn);
    }

    .tag-pill-red {
        background: var(--accent-danger);
    }

    .tag-pill-blue {
        background: var(--accent);
    }

    .badge-risk-high {
        background: var(--accent-danger-soft);
        color: #fecaca;
        border-color: rgba(248,113,113,0.9);
    }

    .badge-risk-medium {
        background: rgba(234,179,8,0.12);
        color: #facc15;
        border-color: rgba(234,179,8,0.8);
    }

    .badge-risk-low {
        background: var(--accent-success-soft);
        color: #bbf7d0;
        border-color: rgba(34,197,94,0.8);
    }

    .badge-status-open {
        background: var(--accent-danger-soft);
        color: #fecaca;
        border-color: rgba(248,113,113,0.8);
    }

    .badge-status-in-progress {
        background: var(--accent-warn-soft);
        color: #fed7aa;
        border-color: rgba(249,115,22,0.85);
    }

    .badge-status-closed {
        background: var(--accent-success-soft);
        color: #bbf7d0;
        border-color: rgba(34,197,94,0.8);
    }

    .tabs {
        display: flex;
        gap: 4px;
        padding: 2px;
        border-radius: 999px;
        background: rgba(15,23,42,0.95);
        border: 1px solid rgba(31,41,55,0.9);
        margin-bottom: 10px;
    }

    .tab {
        padding: 5px 10px;
        font-size: 0.78rem;
        border-radius: 999px;
        cursor: pointer;
        color: var(--text-soft);
        border: 1px solid transparent;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

        .tab.active {
            background: radial-gradient(circle at top left, rgba(59,130,246,0.9), rgba(37,99,235,0.9));
            color: #e5e7eb;
            border-color: rgba(129,140,248,0.9);
        }

    .tab-icon-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: rgba(148,163,184,0.9);
    }

    .tab.active .tab-icon-dot {
        background: #dbeafe;
    }

    .form-grid {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 8px 12px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 3px;
    }

        .form-group.full {
            grid-column: 1 / -1;
        }

    label {
        font-size: 0.72rem;
        color: var(--text-soft);
    }

        label .field-name {
            text-transform: uppercase;
            letter-spacing: 0.14em;
            font-weight: 500;
        }

    input[type="text"],
    input[type="date"],
    select,
    textarea {
        background: var(--input-bg);
        border-radius: 10px;
        border: 1px solid rgba(31,41,55,0.9);
        padding: 5px 8px;
        font-size: 0.8rem;
        color: var(--text-main);
        outline: none;
        transition: border-color 0.14s ease-out;
    }

    textarea {
        resize: vertical;
        min-height: 60px;
    }

        input[readonly],
        textarea[readonly] {
            opacity: 0.9;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: rgba(59,130,246,0.9);
        }

    select {
        padding-right: 22px;
    }

    .section-divider {
        margin: 10px 0 8px;
        border-top: 1px dashed rgba(55,65,81,0.8);
    }

    .risk-matrix-container {
        display: grid;
        grid-template-columns: minmax(0, 2fr) minmax(0, 1.2fr);
        gap: 10px;
        margin-top: 6px;
    }

    .risk-matrix-wrapper {
        border-radius: 14px;
        overflow: hidden;
        border: 1px solid rgba(31,41,55,0.95);
        background: radial-gradient(circle at top, rgba(15,23,42,0.98), rgba(15,23,42,0.96));
    }

    .risk-matrix-header {
        padding: 6px 9px;
        font-size: 0.78rem;
        color: var(--text-soft);
        border-bottom: 1px solid rgba(31,41,55,0.95);
        background: linear-gradient(to bottom, rgba(15,23,42,0.98), rgba(15,23,42,0.92));
    }

    .risk-matrix {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.78rem;
    }

        .risk-matrix th,
        .risk-matrix td {
            border: 1px solid rgba(31,41,55,0.95);
            text-align: center;
            padding: 4px 5px;
        }

        .risk-matrix th {
            background: rgba(15,23,42,0.98);
            color: var(--text-soft);
            font-weight: 500;
        }

            .risk-matrix th.rotate {
                writing-mode: vertical-rl;
                transform: rotate(180deg);
                width: 18px;
                font-size: 0.7rem;
            }

    .risk-cell {
        position: relative;
        font-size: 0.76rem;
        border-radius: 4px;
    }

    /* بدون گرادیانت – رنگ‌های ساده */
    .risk-high {
        background: #991b1b;
        color: #fee2e2;
    }

    .risk-med {
        background: #b45309;
        color: #fffbeb;
    }

    .risk-low {
        background: #166534;
        color: #dcfce7;
    }

    .risk-selected {
        outline: 2px solid #e5e7eb;
        font-weight: 600;
    }

    .risk-legend {
        display: flex;
        flex-direction: column;
        gap: 4px;
        font-size: 0.75rem;
        color: var(--text-soft);
        margin-top: 4px;
    }

    .risk-legend-row {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .risk-legend-color {
        width: 16px;
        height: 10px;
        border-radius: 4px;
    }

        .risk-legend-color.high {
            background: #b91c1c;
        }

        .risk-legend-color.med {
            background: #d97706;
        }

        .risk-legend-color.low {
            background: #16a34a;
        }

    .pill-soft {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        border-radius: 999px;
        padding: 2px 7px 3px;
        font-size: 0.72rem;
        background: rgba(15,23,42,0.9);
        border: 1px solid rgba(55,65,81,0.9);
        color: var(--text-soft);
    }

    .risk-summary {
        font-size: 0.78rem;
        color: var(--text-muted);
        line-height: 1.4;
        margin-top: 4px;
    }

    .link-like {
        color: #93c5fd;
        cursor: pointer;
    }

        .link-like:hover {
            text-decoration: underline;
        }

    .split-2 {
        display: grid;
        grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.7fr);
        gap: 10px;
    }

    .hint {
        font-size: 0.75rem;
        color: var(--text-soft);
    }

        .hint strong {
            color: var(--text-main);
        }

    .pill-metric {
        display: inline-flex;
        align-items: baseline;
        gap: 4px;
        border-radius: 999px;
        padding: 2px 7px 3px;
        border: 1px solid rgba(55,65,81,0.9);
        background: rgba(15,23,42,0.9);
        font-size: 0.72rem;
        color: var(--text-soft);
    }

        .pill-metric span.value {
            font-weight: 600;
            color: var(--text-main);
            font-size: 0.8rem;
        }

        .pill-metric span.label {
            text-transform: uppercase;
            letter-spacing: 0.16em;
        }

    .pill-kpi {
        display: inline-flex;
        flex-direction: column;
        align-items: flex-start;
        gap: 2px;
        padding: 6px 9px;
        border-radius: 14px;
        border: 1px solid rgba(31,41,55,0.9);
        background: radial-gradient(circle at top left, rgba(15,23,42,0.98), rgba(2,6,23,0.98));
        font-size: 0.75rem;
        color: var(--text-soft);
    }

        .pill-kpi strong {
            color: var(--text-main);
            font-size: 0.8rem;
        }

    .kpi-row {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .kpi-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: var(--accent-success);
    }

    .kpi-badge {
        font-size: 0.7rem;
        padding: 1px 6px 2px;
        border-radius: 999px;
        border: 1px solid rgba(55,65,81,0.9);
        background: rgba(15,23,42,0.9);
        color: var(--text-soft);
    }

    .footer {
        height: 26px;
        padding: 4px 16px;
        font-size: 0.7rem;
        color: var(--text-soft);
        border-top: 1px solid rgba(31,41,55,0.9);
        background: rgba(15,23,42,0.96);
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

        .footer span strong {
            color: var(--text-main);
        }

    .link-muted {
        color: var(--text-soft);
        cursor: pointer;
    }

        .link-muted:hover {
            color: var(--text-main);
            text-decoration: underline;
        }

    @media (max-width: 1100px) {
        .card-grid {
            grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.1fr);
        }

        .risk-matrix-container {
            grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.4fr);
        }
    }

    @media (max-width: 920px) {
        .sidebar {
            display: none;
        }

        .card-grid {
            grid-template-columns: minmax(0, 1fr);
        }

        .risk-matrix-container {
            grid-template-columns: minmax(0, 1fr);
        }
    }

    .flex-two-col {
        display: grid;
        grid-template-columns: minmax(0, 2.2fr) minmax(0, 1.3fr);
        gap: 12px;
        align-items: flex-start;
    }

    .pill-list {
        list-style: none;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        gap: 4px;
        font-size: 0.78rem;
    }

    .pill {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 4px 8px;
        border-radius: 999px;
        background: rgba(15,23,42,0.9);
        border: 1px solid rgba(31,41,55,0.9);
    }

    .pill-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: var(--accent);
    }
</style>
<div>
    <div class="page-header">
        <div class="page-title-block">
            <div class="page-title">
                Hazard – {{ item.code || 'New' }}
                <span class="page-title-pill">Details</span>
            </div>
            <div class="page-subtitle">
                End-to-end view of a single hazard: identification, causes, risk, occurrences, actions and monitoring.
            </div>
        </div>
        <div class="page-actions">
            <button class="btn btn-ghost" ng-click="cancel()">
                <span class="icon">←</span>
                Back
            </button>
            <button class="btn btn-primary" ng-click="save()">
                <span class="icon">💾</span>
                Save (demo)
            </button>
        </div>
    </div>

    <div class="card">
        <div class="tabs">
            <div class="tab" ng-class="{active: isTab('overview')}" ng-click="setTab('overview')">
                <span class="tab-icon-dot"></span>
                Overview
            </div>
            <div class="tab" ng-class="{active: isTab('ident')}" ng-click="setTab('ident')">
                <span class="tab-icon-dot"></span>
                Identification
            </div>
            <div class="tab" ng-class="{active: isTab('causes')}" ng-click="setTab('causes')">
                <span class="tab-icon-dot"></span>
                Causes &amp; consequences
            </div>
            <div class="tab" ng-class="{active: isTab('risk')}" ng-click="setTab('risk')">
                <span class="tab-icon-dot"></span>
                Risk assessments
            </div>
            <div class="tab" ng-class="{active: isTab('occ')}" ng-click="setTab('occ')">
                <span class="tab-icon-dot"></span>
                Occurrences
            </div>
            <div class="tab" ng-class="{active: isTab('actions')}" ng-click="setTab('actions')">
                <span class="tab-icon-dot"></span>
                Actions &amp; Monitoring
            </div>
        </div>

        <!-- OVERVIEW -->
        <div ng-show="isTab('overview')">
            <div class="split-2">
                <div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label><span class="field-name">Code</span></label>
                            <input type="text" ng-model="item.code" placeholder="H-00023" />
                        </div>
                        <div class="form-group">
                            <label><span class="field-name">Status</span></label>
                            <select ng-model="item.status">
                                <option value="Open">Open</option>
                                <option value="In progress">In progress</option>
                                <option value="Closed">Closed</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><span class="field-name">Hazard owner (dept / role)</span></label>
                            <input type="text" ng-model="item.ownerDept" placeholder="Flight Safety" />
                        </div>

                        <div class="form-group full">
                            <label><span class="field-name">Title</span></label>
                            <input type="text" ng-model="item.title"
                                   placeholder="Bird strike on approach to OIII" />
                        </div>

                        <div class="form-group full">
                            <label><span class="field-name">Short description</span></label>
                            <textarea ng-model="item.summary"
                                      placeholder="Short description of the hazard..."></textarea>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label><span class="field-name">Initial risk</span></label>
                            <select ng-model="item.initialRisk">
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><span class="field-name">Residual risk</span></label>
                            <select ng-model="item.residualRisk">
                                <option value="High">High</option>
                                <option value="Medium">Medium</option>
                                <option value="Low">Low</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><span class="field-name">Key risk driver</span></label>
                            <input type="text" readonly
                                   ng-model="item.keyDriver"
                                   placeholder="e.g. Bird activity on approach path, seasonal patterns..." />
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <div class="hint">
                        <strong>How to talk through this tab in a demo:</strong>
                        use it to tell the “story” of the hazard in two sentences: what it is, who owns it,
                        and how the risk is currently judged (initial → residual).
                    </div>
                </div>

                <div>
                    <div class="pill-kpi">
                        <strong>Assurance snapshot (demo)</strong>
                        <div class="kpi-row" style="margin-top:4px;">
                            <span class="kpi-dot"></span>
                            <span>Identification sources: {{ sources.length }} (occurrence + audit + MOC)</span>
                        </div>
                        <div class="kpi-row">
                            <span class="kpi-dot" style="background:var(--accent);"></span>
                            <span>Risk assessments in log: {{ riskAssessments.length }}</span>
                        </div>
                        <div class="kpi-row">
                            <span class="kpi-dot" style="background:var(--accent-success);"></span>
                            <span>Linked occurrences (demo): {{ occurrenceCount }}</span>
                        </div>
                        <div class="kpi-row">
                            <span class="kpi-dot" style="background:var(--accent-warn);"></span>
                            <span>Hazard actions recorded: {{ actions.length }}</span>
                        </div>
                    </div>

                    <div style="margin-top:10px;">
                        <span class="pill-metric">
                            <span class="label">Current risk band</span>
                            <span class="value">{{ currentRiskBand() }}</span>
                        </span>
                    </div>

                    <div class="risk-summary">
                        <p style="margin-top:6px;">
                            The risk band above reflects the current assessment in the Risk tab. In a real system,
                            this would be derived from the latest formal risk assessment record.
                        </p>
                    </div>

                    <div class="section-divider"></div>

                    <div class="hint">
                        <strong>Tip for demo:</strong>
                        From here, navigate to <span class="link-like" ng-click="setTab('ident')">Identification</span>
                        to show how the hazard was discovered, then to
                        <span class="link-like" ng-click="setTab('risk')">Risk assessments</span> and finally to
                        <span class="link-like" ng-click="setTab('actions')">Actions &amp; Monitoring</span>
                        to close the loop.
                    </div>
                </div>
            </div>
        </div>

        <!-- IDENTIFICATION -->
        <div ng-show="isTab('ident')">
            <div class="form-grid">
                <div class="form-group full">
                    <label><span class="field-name">How this hazard was identified</span></label>
                    <p class="hint" style="margin:0;">
                        This section records the main sources that revealed the hazard, such as occurrence reports,
                        internal or external audits, MOC risk assessments, studies or safety meetings.
                    </p>
                </div>
            </div>

            <div class="section-divider"></div>

            <div class="card" style="background:none; border:none; padding:0;">
                <div class="card-subtitle" style="margin-bottom:4px;">Identification sources (demo)</div>
                <table>
                    <thead>
                        <tr>
                            <th>Primary</th>
                            <th>Method</th>
                            <th>Reference</th>
                            <th>Title / context</th>
                            <th>Date</th>
                            <th>Module</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="s in sources">
                            <td>
                                <input type="radio" name="primarySource"
                                       ng-checked="s.isPrimary"
                                       ng-click="setPrimary($index)" />
                            </td>
                            <td>
                                <select ng-model="s.methodCode"
                                        ng-options="m.code as m.title for m in identificationMethods">
                                </select>
                            </td>
                            <td><input type="text" ng-model="s.refCode" placeholder="e.g. ASR-2025-00123" /></td>
                            <td><input type="text" ng-model="s.refTitle" placeholder="Short title of the source..." /></td>
                            <td><input type="date" ng-model="s.dateIdentified" /></td>
                            <td><input type="text" ng-model="s.refModule" placeholder="Occurrences / MOC / Audit..." /></td>
                        </tr>
                    </tbody>
                </table>

                <div style="margin-top:6px; display:flex; gap:8px;">
                    <button class="btn btn-ghost" ng-click="addSource()">
                        <span class="icon">＋</span>
                        Add source
                    </button>
                    <button class="btn btn-ghost" ng-click="removeSource(sources.length - 1)"
                            ng-disabled="sources.length <= 1">
                        <span class="icon">−</span>
                        Remove last
                    </button>
                </div>
            </div>
        </div>

        <!-- CAUSES & CONSEQUENCES -->
        <div ng-show="isTab('causes')">
            <div class="form-grid">
                <div class="form-group full">
                    <label><span class="field-name">Causes and consequences (concept only)</span></label>
                    <p class="hint" style="margin:0;">
                        In a production system, this tab would be linked to structured cause/consequence categories
                        (e.g. HFACS, technical, environmental). Here we only show that the hazard record provides
                        a home for structured analysis of why the hazard exists and what it can lead to.
                    </p>
                </div>
                <div class="form-group full">
                    <label><span class="field-name">Root causes (free text demo)</span></label>
                    <textarea placeholder="E.g. wildlife attraction around airport, insufficient bird control coverage, seasonal migratory patterns..."></textarea>
                </div>
                <div class="form-group full">
                    <label><span class="field-name">Potential consequences</span></label>
                    <textarea placeholder="E.g. engine damage, rejected take-off, emergency return, runway closure, schedule disruption, injuries..."></textarea>
                </div>
            </div>
        </div>

        <!-- RISK -->
        <div ng-show="isTab('risk')">
            <div class="risk-matrix-container">
                <div class="risk-matrix-wrapper">
                    <div class="risk-matrix-header">
                        5×5 risk matrix (demo) – click anywhere in the grid to explain how “High / Medium / Low” are derived.
                    </div>
                    <table class="risk-matrix">
                        <thead>
                            <tr>
                                <th rowspan="2" class="rotate">Severity</th>
                                <th colspan="5">Likelihood</th>
                            </tr>
                            <tr>
                                <th>1<br />Extremely improbable</th>
                                <th>2<br />Improbable</th>
                                <th>3<br />Remote</th>
                                <th>4<br />Occasional</th>
                                <th>5<br />Frequent</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="s in severityLevels">
                                <th>{{ s.code }}<br />{{ s.title }}</th>
                                <td ng-repeat="l in [1,2,3,4,5]"
                                    ng-class="riskCellClass(s.code, l)">
                                    {{ l }}{{ s.code }}
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="risk-legend">
                        <div class="risk-legend-row">
                            <span class="risk-legend-color high"></span>
                            <span>Unacceptable – further risk reduction required before continuing operations.</span>
                        </div>
                        <div class="risk-legend-row">
                            <span class="risk-legend-color med"></span>
                            <span>Undesirable / acceptable with controls – only acceptable with strong mitigations.</span>
                        </div>
                        <div class="risk-legend-row">
                            <span class="risk-legend-color low"></span>
                            <span>Acceptable – monitor through routine safety assurance.</span>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="card" style="padding:8px 10px;">
                        <div class="card-title" style="margin-bottom:4px;">Current assessment (demo)</div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label><span class="field-name">Severity</span></label>
                                <select ng-model="currentAssessment.severity"
                                        ng-options="s.code as (s.code + ' – ' + s.title) for s in severityLevels">
                                </select>
                            </div>
                            <div class="form-group">
                                <label><span class="field-name">Likelihood</span></label>
                                <select ng-model="currentAssessment.likelihood"
                                        ng-options="l.code as (l.code + ' – ' + l.title) for l in likelihoodLevels">
                                </select>
                            </div>
                            <div class="form-group">
                                <label><span class="field-name">Matrix cell</span></label>
                                <input type="text" readonly ng-model="currentRiskCode()" />
                            </div>
                            <div class="form-group full">
                                <label><span class="field-name">Risk band (demo logic)</span></label>
                                <input type="text" readonly ng-model="currentRiskBand()" />
                            </div>
                        </div>
                        <div class="risk-summary">
                            <p style="margin-top:6px;">
                                In this demo the band is derived by multiplying a numeric value for severity
                                (A=5 … E=1) by the likelihood level and mapping the score to the risk bands.
                                In a real implementation this would follow your exact matrix definition.
                            </p>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <div class="card" style="padding:8px 10px;">
                        <div class="page-subtitle" style="margin-bottom:4px;">
                            Risk assessment history for this hazard
                        </div>
                        <p class="hint" style="margin:0 0 6px;">
                            Each row represents a formal risk assessment (initial assessment, reassessment after
                            new controls, post-MOC review, etc.) with the initial and residual matrix indices.
                        </p>
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>No</th>
                                    <th>Initial index</th>
                                    <th>Initial risk</th>
                                    <th>Residual index</th>
                                    <th>Residual risk</th>
                                    <th>Acceptability</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="ra in riskAssessments">
                                    <td>{{ ra.date }}</td>
                                    <td>{{ ra.assessmentNo }}</td>
                                    <td>{{ ra.initialIndex }}</td>
                                    <td>{{ ra.initial }}</td>
                                    <td>{{ ra.residualIndex }}</td>
                                    <td>{{ ra.residual }}</td>
                                    <td>{{ ra.acceptability }}</td>
                                </tr>
                                <tr ng-if="!riskAssessments.length">
                                    <td colspan="7" style="font-size:0.85rem; color:var(--text-muted);">
                                        No risk assessments recorded for this hazard in demo data.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- OCCURRENCES -->
        <div ng-show="isTab('occ')">
            <p class="hint" style="margin-top:0;">
                This tab provides an overview of occurrences linked to this hazard (e.g. bird strikes, ramp
                incidents). In a full implementation this would drill down to the occurrence module.
            </p>

            <div class="card" style="padding:8px 10px;">
                <div class="page-subtitle" style="margin-bottom:4px;">Occurrences (demo)</div>
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Flight / ref</th>
                            <th>Type</th>
                            <th>Severity</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="o in relatedOccurrences">
                            <td>{{ o.date }}</td>
                            <td>{{ o.ref }}</td>
                            <td>{{ o.type }}</td>
                            <td>{{ o.severity }}</td>
                            <td>{{ o.status }}</td>
                        </tr>
                        <tr ng-if="!relatedOccurrences.length">
                            <td colspan="5" style="font-size:0.85rem; color:var(--text-muted);">
                                No occurrences linked in this demo. In a real system this tab would summarise
                                all reports tagged to this hazard.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ACTIONS & MONITORING -->
        <div ng-show="isTab('actions')">
            <p class="hint" style="margin-top:0;">
                <strong>Actions &amp; monitoring = how we treat and follow up the hazard.</strong>
                This tab summarises hazard-level risk controls / corrective actions and how their effectiveness
                is monitored over time (SPIs, audits, inspections, etc.).
            </p>

            <div class="card" style="padding:8px 10px;">
                <div class="page-subtitle" style="margin-bottom:4px;">Risk controls / actions</div>
                <table>
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Action / control</th>
                            <th>Type</th>
                            <th>Owner (role / dept)</th>
                            <th>Target date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="a in actions">
                            <td>{{ a.actionNo }}</td>
                            <td>{{ a.action }}</td>
                            <td>{{ a.type }}</td>
                            <td>{{ a.owner }}</td>
                            <td>{{ a.targetDate }}</td>
                            <td>{{ a.status }}</td>
                        </tr>
                        <tr ng-if="!actions.length">
                            <td colspan="6" style="font-size:0.85rem; color:var(--text-muted);">
                                No specific controls / actions recorded for this hazard in demo data.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="card" style="padding:8px 10px; margin-top:8px;">
                <div class="page-subtitle" style="margin-bottom:4px;">Monitoring &amp; review</div>
                <table>
                    <thead>
                        <tr>
                            <th>Indicator / SPI</th>
                            <th>Monitoring method</th>
                            <th>Frequency</th>
                            <th>Last review</th>
                            <th>Next review</th>
                            <th>Conclusion</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="m in monitoring">
                            <td>{{ m.indicator }}</td>
                            <td>{{ m.method }}</td>
                            <td>{{ m.frequency }}</td>
                            <td>{{ m.lastReview }}</td>
                            <td>{{ m.nextReview }}</td>
                            <td>{{ m.conclusion }}</td>
                        </tr>
                        <tr ng-if="!monitoring.length">
                            <td colspan="6" style="font-size:0.85rem; color:var(--text-muted);">
                                No monitoring plan recorded for this hazard in demo data.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>